<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - Lustre covering</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html, body {
            scroll-behavior: smooth;
            overflow-x: hidden;
        }
        body {
            font-family: 'Poppins', sans-serif;
        }
        .bg-cover-image {
            background-image: url(./gold-jewelry.jpeg); /* Make sure this path is correct */
        }
        /* Custom styles for validation */
        .error-message {
            color: #dc2626; /* red-600 */
            font-size: 0.875rem; /* text-sm */
            margin-top: 0.25rem;
            display: none; /* Hidden by default */
        }
        .input-error {
            border-color: #dc2626 !important; /* red-600 */
            box-shadow: 0 0 0 1px #dc2626;
        }
        .input-success {
            border-color: #16a34a !important; /* green-600 */
            box-shadow: 0 0 0 1px #16a34a;
        }
        .password-strength {
            display: flex;
            gap: 2px;
            margin-top: 4px;
        }
        .strength-bar {
            height: 4px;
            flex-grow: 1;
            background-color: #e5e7eb; /* gray-200 */
            border-radius: 2px;
        }
        .strength-bar.weak { background-color: #ef4444; } /* red-500 */
        .strength-bar.medium { background-color: #f59e0b; } /* amber-500 */
        .strength-bar.strong { background-color: #22c55e; } /* green-500 */
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4 bg-cover bg-center bg-cover-image">
    <div class="w-full max-w-2xl bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl p-8 md:p-12 border border-gray-200">
        <h1 class="text-3xl md:text-4xl font-extrabold text-center text-gray-800 mb-8 font-serif">
            Create Your Account
        </h1>
        <form id="registerForm" novalidate> <!-- novalidate disables default browser validation -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                <!-- Full Name -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-user text-gray-400"></i></div>
                        <input type="text" id="name" name="name" placeholder="Enter your full name" class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 transition" />
                    </div>
                    <p id="nameError" class="error-message">Name must be at least 3 characters long.</p>
                </div>
                <!-- Email -->
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-envelope text-gray-400"></i></div>
                        <input type="email" id="email" name="email" placeholder="Enter your email" class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 transition" />
                    </div>
                    <p id="emailError" class="error-message">Please enter a valid email address.</p>
                </div>
                <!-- Password -->
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-lock text-gray-400"></i></div>
                        <input type="password" id="password" name="password" placeholder="Create a strong password" class="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 transition" />
                        <!-- Show/Hide Password Button -->
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                            <button type="button" id="togglePassword" class="text-gray-400 hover:text-gray-600 focus:outline-none">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="password-strength" id="passwordStrengthIndicator">
                        <div class="strength-bar"></div><div class="strength-bar"></div><div class="strength-bar"></div>
                    </div>
                    <p id="passwordError" class="error-message">Password must be 8+ chars with uppercase, lowercase, number, and special character.</p>
                </div>
                <!-- Confirm Password -->
                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-700">Confirm Password</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-lock text-gray-400"></i></div>
                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm your password" class="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 transition" />
                        <!-- Show/Hide Confirm Password Button -->
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                            <button type="button" id="toggleConfirmPassword" class="text-gray-400 hover:text-gray-600 focus:outline-none">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <p id="confirmPasswordError" class="error-message">Passwords do not match.</p>
                </div>
                <!-- Phone Number -->
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-phone text-gray-400"></i></div>
                        <input type="tel" id="phone" name="phone" placeholder="Enter your 10-digit number" class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 transition" />
                    </div>
                    <p id="phoneError" class="error-message">Please enter a valid 10-digit phone number.</p>
                </div>
                <!-- Address -->
                <div class="md:col-span-2">
                    <label for="address" class="block text-sm font-medium text-gray-700">Address</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute top-3 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-map-marker-alt text-gray-400"></i></div>
                        <textarea id="address" name="address" rows="3" placeholder="Enter your full address" class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 transition"></textarea>
                    </div>
                     <p id="addressError" class="error-message">Address is required.</p>
                </div>
            </div>

            <div id="messageContainer" class="mt-6 min-h-[48px]"></div>

            <button type="submit" id="registerBtn" class="w-full mt-6 flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-full shadow-lg text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition">
                Register
            </button>
            
            <p class="mt-6 text-center text-sm text-gray-600">
                Already have an account? 
                <a href="login.html" class="font-medium text-yellow-600 hover:text-yellow-500 hover:underline">Login here</a>
            </p>
        </form>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Form and Input Elements ---
    const registerForm = document.getElementById('registerForm');
    const registerBtn = document.getElementById('registerBtn');
    const messageContainer = document.getElementById('messageContainer');

    const inputs = {
        name: document.getElementById('name'),
        email: document.getElementById('email'),
        password: document.getElementById('password'),
        confirmPassword: document.getElementById('confirmPassword'),
        phone: document.getElementById('phone'),
        address: document.getElementById('address')
    };

    // --- Validation Rules (Regular Expressions) ---
    const validationRules = {
        name: { regex: /^[a-zA-Z\s]{3,}$/, message: "Name must be at least 3 characters and contain only letters." },
        email: { regex: /^[^\s@]+@[^\s@]+\.[^\s@]+$/, message: "Please enter a valid email address." },
        password: { regex: /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/, message: "Must be 8+ chars with uppercase, lowercase, number, and special character." },
        confirmPassword: { validator: (val) => val === inputs.password.value, message: "Passwords do not match." },
        phone: { regex: /^[0-9]{10}$/, message: "Please enter a valid 10-digit phone number." },
        address: { regex: /.{5,}/, message: "Address must be at least 5 characters long." }
    };

    // --- Helper Functions ---
    const showMessage = (message, isSuccess) => {
        const alertClass = isSuccess ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700";
        messageContainer.innerHTML = `<div class="p-4 border rounded-md ${alertClass}">${message}</div>`;
    };

    const setInputState = (input, isValid) => {
        const errorElement = document.getElementById(`${input.id}Error`);
        input.classList.remove('input-error', 'input-success');
        errorElement.style.display = 'none';

        if (isValid === true) {
            input.classList.add('input-success');
        } else if (isValid === false) {
            input.classList.add('input-error');
            errorElement.style.display = 'block';
        }
    };

    const validateField = (input) => {
        const rule = validationRules[input.name];
        if (!rule) return true;

        const value = input.value.trim();
        const isValid = rule.validator ? rule.validator(value) : rule.regex.test(value);
        setInputState(input, isValid);
        
        if (input.name === 'password') {
            validateField(inputs.confirmPassword);
            updatePasswordStrength();
        }

        return isValid;
    };
    
    const updatePasswordStrength = () => {
        const password = inputs.password.value;
        const strengthIndicator = document.getElementById('passwordStrengthIndicator');
        const bars = strengthIndicator.querySelectorAll('.strength-bar');
        
        bars.forEach(bar => bar.className = 'strength-bar'); // Reset

        let score = 0;
        if (password.length >= 8) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/[a-z]/.test(password)) score++;
        if (/\d/.test(password)) score++;
        if (/[@$!%*?&]/.test(password)) score++;

        if (score > 0 && score <= 2) bars[0].classList.add('weak');
        if (score > 2 && score <= 4) { bars[0].classList.add('medium'); bars[1].classList.add('medium'); }
        if (score >= 5) { bars.forEach(bar => bar.classList.add('strong')); }
    };

    // --- Attach Event Listeners for Live Validation ---
    for (const key in inputs) {
        inputs[key].addEventListener('input', () => validateField(inputs[key]));
    }

    // --- NEW: Show/Hide Password Logic ---
    const togglePasswordBtn = document.getElementById('togglePassword');
    const toggleConfirmPasswordBtn = document.getElementById('toggleConfirmPassword');

    const toggleVisibility = (input, button) => {
        const icon = button.querySelector('i');
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    };

    if(togglePasswordBtn) {
        togglePasswordBtn.addEventListener('click', () => toggleVisibility(inputs.password, togglePasswordBtn));
    }
    if(toggleConfirmPasswordBtn) {
        toggleConfirmPasswordBtn.addEventListener('click', () => toggleVisibility(inputs.confirmPassword, toggleConfirmPasswordBtn));
    }
    // --- END NEW LOGIC ---

    // --- Form Submission Handler ---
    registerForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        messageContainer.innerHTML = '';
        
        let isFormValid = true;
        for (const key in inputs) {
            if (!validateField(inputs[key])) {
                isFormValid = false;
            }
        }
        
        if (!isFormValid) {
            showMessage("Please correct the errors before submitting.", false);
            return;
        }

        registerBtn.disabled = true;
        registerBtn.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Loading...`;

        const formData = new URLSearchParams();
        for(const key in inputs) {
            formData.append(key, inputs[key].value.trim());
        }

        try {
            const response = await fetch("https://mainprojectapi.onrender.com/users/register", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: formData
            });

            const result = await response.json();

            if (response.ok && result.status === "success") {
                showMessage(result.message || "Registration successful! Redirecting...", true);
                setTimeout(() => { window.location.href = "login.html"; }, 2000);
            } else {
                showMessage(result.message || "Registration failed. Please try again.", false);
            }
        } catch (error) {
            showMessage("Network error occurred. Please try again.", false);
        } finally {
            registerBtn.disabled = false;
            registerBtn.innerHTML = "Register";
        }
    });
});
</script>
</body>
</html>

